


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="python">
  <head>
    <meta charset="utf-8" />
    <title>3. Advanced Tutorial &#8212; eonr 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"], "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.base.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Background" href="background.html" />
    <link rel="prev" title="2. Tutorial" href="tutorial.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="background.html" title="4. Background"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="tutorial.html" title="2. Tutorial"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">eonr 0.0.1 documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for cloud theme */

/* nicer titles and more space for info and warning logos */

div.admonition p.admonition-title {
    background: rgba(0, 0, 0, .05);
    margin: .5em -1em;
    margin-top: -.5em !important;
    padding: .5em .5em .5em 2.65em;
}

/* indent single paragraph */
div.admonition {
    text-indent: 20px;
}
/* don't indent multiple paragraphs */
div.admonition > p {
    text-indent: 0;
}
/* remove excessive padding */
div.admonition.inline-title p.admonition-title {
    padding-left: .2em;
}
</style>
<div class="section" id="Advanced-Tutorial">
<h1>3. Advanced Tutorial<a class="headerlink" href="#Advanced-Tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Follow-along">
<h2>3.1. Follow along<a class="headerlink" href="#Follow-along" title="Permalink to this headline">¶</a></h2>
<p>Code for all the examples is located in your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH/Lib/site-packages/eonr/examples</span></code> folder. With that said, you should be able to make use of <code class="docutils literal notranslate"><span class="pre">EONR</span></code> by following and executing the commands in this tutorial using either the sample data provided or substituting in your own data.</p>
<p><em>You will find the following code included in the</em> <code class="docutils literal notranslate"><span class="pre">advanced_tutorial.py</span></code> <em>or</em> <code class="docutils literal notranslate"><span class="pre">advanced_tutorial.ipynb</span></code> <em>(for</em><a class="reference external" href="https://jupyter.org/">Jupyter notebooks</a><em>) files in your</em> <code class="docutils literal notranslate"><span class="pre">PYTHONPATH/Lib/site-packages/eonr/examples</span></code> <em>folder - feel free to load that into your Python IDE to follow along.</em></p>
</div>
<hr class="docutils" />
<div class="section" id="Calculate-EONR-for-several-economic-scenarios">
<h2>3.2. Calculate <code class="docutils literal notranslate"><span class="pre">EONR</span></code> for several economic scenarios<a class="headerlink" href="#Calculate-EONR-for-several-economic-scenarios" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we will run <code class="docutils literal notranslate"><span class="pre">EONR.calculate_eonr()</span></code> in a loop, adjusting the economic scenario prior to each run.</p>
</div>
<hr class="docutils" />
<div class="section" id="Load-modules">
<h2>3.3. Load modules<a class="headerlink" href="#Load-modules" title="Permalink to this headline">¶</a></h2>
<p>Load <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">EONR</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">eonr</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Load-the-data">
<h2>3.4. Load the data<a class="headerlink" href="#Load-the-data" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">EONR</span></code> uses Pandas dataframes to access and manipulate the experimental data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;data\minnesota_2012.csv&#39;</span><span class="p">)</span>
<span class="n">df_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>location</th>
      <th>plot</th>
      <th>trt</th>
      <th>rep</th>
      <th>time_n</th>
      <th>rate_n_applied_kgha</th>
      <th>yld_grain_dry_kgha</th>
      <th>nup_total_kgha</th>
      <th>soil_plus_fert_n_kgha</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>101</td>
      <td>8</td>
      <td>1</td>
      <td>Pre</td>
      <td>235.3785</td>
      <td>12410.916200</td>
      <td>198.759898</td>
      <td>284.69590</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>102</td>
      <td>3</td>
      <td>1</td>
      <td>Pre</td>
      <td>67.2510</td>
      <td>10627.946000</td>
      <td>147.971755</td>
      <td>116.56840</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>103</td>
      <td>1</td>
      <td>1</td>
      <td>Pre</td>
      <td>0.0000</td>
      <td>7428.081218</td>
      <td>98.769392</td>
      <td>38.10890</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>104</td>
      <td>2</td>
      <td>1</td>
      <td>Pre</td>
      <td>33.6255</td>
      <td>9202.953180</td>
      <td>111.440210</td>
      <td>71.73440</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>105</td>
      <td>4</td>
      <td>2</td>
      <td>Pre</td>
      <td>100.8765</td>
      <td>10841.127180</td>
      <td>142.663887</td>
      <td>154.67730</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>106</td>
      <td>7</td>
      <td>2</td>
      <td>Pre</td>
      <td>201.7530</td>
      <td>10646.649330</td>
      <td>178.802092</td>
      <td>255.55380</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>107</td>
      <td>6</td>
      <td>2</td>
      <td>Pre</td>
      <td>168.1275</td>
      <td>12367.436000</td>
      <td>186.053531</td>
      <td>201.75300</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>108</td>
      <td>5</td>
      <td>2</td>
      <td>Pre</td>
      <td>134.5020</td>
      <td>13366.361700</td>
      <td>196.737290</td>
      <td>168.12750</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>201</td>
      <td>7</td>
      <td>1</td>
      <td>Pre</td>
      <td>201.7530</td>
      <td>14232.053480</td>
      <td>228.775204</td>
      <td>251.07040</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>202</td>
      <td>5</td>
      <td>1</td>
      <td>Pre</td>
      <td>134.5020</td>
      <td>14384.824980</td>
      <td>226.006218</td>
      <td>183.81940</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>203</td>
      <td>6</td>
      <td>1</td>
      <td>Pre</td>
      <td>168.1275</td>
      <td>13592.219290</td>
      <td>182.423028</td>
      <td>206.23640</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>204</td>
      <td>4</td>
      <td>1</td>
      <td>Pre</td>
      <td>100.8765</td>
      <td>14091.078390</td>
      <td>187.745096</td>
      <td>138.98540</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>205</td>
      <td>3</td>
      <td>2</td>
      <td>Pre</td>
      <td>67.2510</td>
      <td>10739.981390</td>
      <td>133.470950</td>
      <td>121.05180</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>206</td>
      <td>1</td>
      <td>2</td>
      <td>Pre</td>
      <td>0.0000</td>
      <td>8375.090921</td>
      <td>109.460245</td>
      <td>53.80080</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>207</td>
      <td>8</td>
      <td>2</td>
      <td>Pre</td>
      <td>235.3785</td>
      <td>13797.485850</td>
      <td>195.932161</td>
      <td>269.00400</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>208</td>
      <td>2</td>
      <td>2</td>
      <td>Pre</td>
      <td>33.6255</td>
      <td>9713.487469</td>
      <td>113.903035</td>
      <td>67.25100</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>301</td>
      <td>3</td>
      <td>3</td>
      <td>Pre</td>
      <td>67.2510</td>
      <td>12579.012170</td>
      <td>180.812783</td>
      <td>106.48075</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>302</td>
      <td>7</td>
      <td>3</td>
      <td>Pre</td>
      <td>201.7530</td>
      <td>13604.571780</td>
      <td>208.724988</td>
      <td>240.98275</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>303</td>
      <td>2</td>
      <td>3</td>
      <td>Pre</td>
      <td>33.6255</td>
      <td>10185.959390</td>
      <td>121.505528</td>
      <td>68.37185</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>304</td>
      <td>6</td>
      <td>3</td>
      <td>Pre</td>
      <td>168.1275</td>
      <td>14305.321460</td>
      <td>204.391319</td>
      <td>202.87385</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>305</td>
      <td>8</td>
      <td>4</td>
      <td>Pre</td>
      <td>235.3785</td>
      <td>13929.592020</td>
      <td>186.775288</td>
      <td>267.88315</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>306</td>
      <td>4</td>
      <td>4</td>
      <td>Pre</td>
      <td>100.8765</td>
      <td>10975.799250</td>
      <td>147.057081</td>
      <td>133.38115</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>307</td>
      <td>5</td>
      <td>4</td>
      <td>Pre</td>
      <td>134.5020</td>
      <td>11338.070290</td>
      <td>148.348790</td>
      <td>162.52325</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>308</td>
      <td>1</td>
      <td>4</td>
      <td>Pre</td>
      <td>0.0000</td>
      <td>5821.373521</td>
      <td>68.791363</td>
      <td>28.02125</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>401</td>
      <td>5</td>
      <td>3</td>
      <td>Pre</td>
      <td>134.5020</td>
      <td>13755.002370</td>
      <td>198.844611</td>
      <td>173.73175</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>402</td>
      <td>1</td>
      <td>3</td>
      <td>Pre</td>
      <td>0.0000</td>
      <td>9077.628329</td>
      <td>122.207140</td>
      <td>39.22975</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>403</td>
      <td>4</td>
      <td>3</td>
      <td>Pre</td>
      <td>100.8765</td>
      <td>13760.323240</td>
      <td>181.734857</td>
      <td>135.62285</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>404</td>
      <td>8</td>
      <td>3</td>
      <td>Pre</td>
      <td>235.3785</td>
      <td>14896.886860</td>
      <td>227.454749</td>
      <td>270.12485</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>405</td>
      <td>2</td>
      <td>4</td>
      <td>Pre</td>
      <td>33.6255</td>
      <td>10551.466010</td>
      <td>144.282839</td>
      <td>66.13015</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>406</td>
      <td>6</td>
      <td>4</td>
      <td>Pre</td>
      <td>168.1275</td>
      <td>15621.406530</td>
      <td>227.056199</td>
      <td>200.63215</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>407</td>
      <td>3</td>
      <td>4</td>
      <td>Pre</td>
      <td>67.2510</td>
      <td>10950.450720</td>
      <td>146.628851</td>
      <td>95.27225</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2012</td>
      <td>Minnesota</td>
      <td>408</td>
      <td>7</td>
      <td>4</td>
      <td>Pre</td>
      <td>201.7530</td>
      <td>13838.222530</td>
      <td>210.340625</td>
      <td>229.77425</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Set-column-names-and-units">
<h2>3.5. Set column names and units<a class="headerlink" href="#Set-column-names-and-units" title="Permalink to this headline">¶</a></h2>
<p><em>The table containing the experimental data</em><strong>must</strong><em>have a minimum of two columns:</em> * <em>Nitrogen fertilizer rate</em> * <em>Grain yield</em></p>
<p>We’ll also set <em>nitrogen uptake</em> and <em>available nitrogen</em> columns right away for calculating the socially optimum nitrogen rate.</p>
<p>As a reminder, we are declaring the names of these columns and units because they will be passed to <code class="docutils literal notranslate"><span class="pre">EONR</span></code> later.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">col_n_app</span> <span class="o">=</span> <span class="s1">&#39;rate_n_applied_kgha&#39;</span>
<span class="n">col_yld</span> <span class="o">=</span> <span class="s1">&#39;yld_grain_dry_kgha&#39;</span>
<span class="n">col_crop_nup</span> <span class="o">=</span> <span class="s1">&#39;nup_total_kgha&#39;</span>
<span class="n">col_n_avail</span> <span class="o">=</span> <span class="s1">&#39;soil_plus_fert_n_kgha&#39;</span>

<span class="n">unit_currency</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span>
<span class="n">unit_fert</span> <span class="o">=</span> <span class="s1">&#39;kg&#39;</span>
<span class="n">unit_grain</span> <span class="o">=</span> <span class="s1">&#39;kg&#39;</span>
<span class="n">unit_area</span> <span class="o">=</span> <span class="s1">&#39;ha&#39;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Turn-base_zero-off">
<h2>3.6. Turn <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> off<a class="headerlink" href="#Turn-base_zero-off" title="Permalink to this headline">¶</a></h2>
<p>You might have noticed the <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> option for the <code class="docutils literal notranslate"><span class="pre">EONR</span></code> class in the <a class="reference external" href="my_eonr.html#module-eonr.eonr">API</a>. <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> is a <code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">False</span></code> flag that determines if gross return to nitrogen should be expressed as an absolute values. We will see a bit later that upon executing <code class="docutils literal notranslate"><span class="pre">EONR.calculate_eonr()</span></code>, grain yield from the input dataset is used to create a new column for gross return to nitrogen <em>(“grtn”)</em> by multiplying the grain yield column by the price of grain
(<code class="docutils literal notranslate"><span class="pre">price_grain</span></code> variable).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> <em>(default)</em>, the observed yield return data are standardized so that the best-fit quadratic-plateau model passes through the y-axis at zero. This is done in two steps: 1. Fit the quadratic-plateau to the original data to determine the value of the y-intercept of the model (<span class="math notranslate nohighlight">\(\beta_0\)</span>) 2. Subtract <span class="math notranslate nohighlight">\(\beta_0\)</span> from all data in the recently created <em>“grtn”</em> column (temporarily stored in <code class="docutils literal notranslate"><span class="pre">EONR.df_data</span></code>)</p>
<p>This behavior (<code class="docutils literal notranslate"><span class="pre">base_zero</span> <span class="pre">=</span> <span class="pre">True</span></code>) is the default in <code class="docutils literal notranslate"><span class="pre">EONR</span></code>. However, <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> can simply be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> during the initialization of <code class="docutils literal notranslate"><span class="pre">EONR</span></code>. We will set it store it in its own variable now, then pass to <code class="docutils literal notranslate"><span class="pre">EONR</span></code> during initialization:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">base_zero</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Initialize-EONR">
<h2>3.7. Initialize <code class="docutils literal notranslate"><span class="pre">EONR</span></code><a class="headerlink" href="#Initialize-EONR" title="Permalink to this headline">¶</a></h2>
<p>Let’s set the base directory and initialize an instance of <code class="docutils literal notranslate"><span class="pre">EONR</span></code>, setting <code class="docutils literal notranslate"><span class="pre">cost_n_fert</span> <span class="pre">=</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">price_grain</span> <span class="pre">=</span> <span class="pre">1.0</span></code> ($1.00 per kg) as the default values (we will adjust them later on in the tutorial):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;eonr_advanced_tutorial&#39;</span><span class="p">)</span>

<span class="n">my_eonr</span> <span class="o">=</span> <span class="n">eonr</span><span class="o">.</span><span class="n">EONR</span><span class="p">(</span><span class="n">cost_n_fert</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">price_grain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">col_n_app</span><span class="o">=</span><span class="n">col_n_app</span><span class="p">,</span>
                    <span class="n">col_yld</span><span class="o">=</span><span class="n">col_yld</span><span class="p">,</span>
                    <span class="n">col_crop_nup</span><span class="o">=</span><span class="n">col_crop_nup</span><span class="p">,</span>
                    <span class="n">col_n_avail</span><span class="o">=</span><span class="n">col_n_avail</span><span class="p">,</span>
                    <span class="n">unit_currency</span><span class="o">=</span><span class="n">unit_currency</span><span class="p">,</span>
                    <span class="n">unit_grain</span><span class="o">=</span><span class="n">unit_grain</span><span class="p">,</span>
                    <span class="n">unit_fert</span><span class="o">=</span><span class="n">unit_fert</span><span class="p">,</span>
                    <span class="n">unit_area</span><span class="o">=</span><span class="n">unit_area</span><span class="p">,</span>
                    <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span>
                    <span class="n">base_zero</span><span class="o">=</span><span class="n">base_zero</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Calculate-the-AONR">
<h2>3.8. Calculate the <em>AONR</em><a class="headerlink" href="#Calculate-the-AONR" title="Permalink to this headline">¶</a></h2>
<p>You may be wondering why <code class="docutils literal notranslate"><span class="pre">cost_n_fert</span></code> was set to 0. Well, setting our nitrogen fertilizer cost to
\<span class="math notranslate nohighlight">\(0 essentially allows us to calculate the optimum nitrogen rate ignoring the cost of the fertilizer input. This is known as the *Agronomic Optimum Nitrogen Rate (AONR)*. The AONR provides insight into the maximum achievable grain yield. Notice \)</span> was set to <cite>1.0</cite> - this effectively calculates the AONR so that the maximum return to nitrogen (MRTN), which will be expressed as ` per ha when ploting via <code class="docutils literal notranslate"><span class="pre">EONR.plot_eonr()</span></code>, is similar to units of kg per ha (the units we are
using for grain yield).</p>
<p>Let’s calculate the AONR and plot it (adjusting <code class="docutils literal notranslate"><span class="pre">y_max</span></code> so it is greater than our maximum grain yield):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_eonr</span><span class="o">.</span><span class="n">calculate_eonr</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
<span class="n">my_eonr</span><span class="o">.</span><span class="n">plot_eonr</span><span class="p">(</span><span class="n">x_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mi">18000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Computing AONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.00 per kg
Price grain: $1.00 per kg
Agronomic optimum N rate (AONR): 177.4 kg per ha [139.9, 234.0] (90.0% confidence)
Maximum return to N (MRTN): $13579.23 per ha
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_12_1.png" src="_images/advanced_tutorial_12_1.png" />
</div>
</div>
<p>We see that the <strong>agronomic</strong> optimum nitrogen rate was calculated as <strong>177</strong> kg per ha, and the MRTN is <strong>13.579 Mg per ha</strong> (yes, it says $13,579, but because <code class="docutils literal notranslate"><span class="pre">price_grain</span></code> was set to \$1, the values are equivalent and the units can be substituted.</p>
<p>If you’ve gone through the <a class="reference internal" href="tutorial.html"><span class="doc">first tutorial</span></a>, you’ll notice there are a few major differences in the look of this plot:</p>
<p><strong>The red line representing nitrogen fertilizer cost is on the bottom of the plot</strong> <em>This happened because</em> <code class="docutils literal notranslate"><span class="pre">cost_n_fert</span></code> <em>was set to zero, and nitrogen fertilizer cost is simply being plotted as a flat horizontal line at</em> <span class="math notranslate nohighlight">\(\text{y}=0\)</span></p>
<p><strong>The blue line is missing?</strong> *The gross return to nitrogen (GRTN) line representing the best-fit of the quadratic-plateau model (blue line) is there, but it is actually being covered up by the green line (net return to nitrogen; NRTN). This is the case because <code class="docutils literal notranslate"><span class="pre">cost_n_fert</span></code> was set to zero.</p>
<p><strong>The GRTN/NRTN lines do not pass through the y-intercept at</strong> <span class="math notranslate nohighlight">\(\text{y}=0\)</span><strong>?</strong></p>
<p><em>Because</em> <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> <em>was set to</em> <code class="docutils literal notranslate"><span class="pre">False</span></code>, <em>the observed data (blue points) were not standardized as to</em>force* the best-fit quadratic-plateau model from passing through at* <span class="math notranslate nohighlight">\(\text{y}=0\)</span>.</p>
</div>
<hr class="docutils" />
<div class="section" id="Loop-through-several-economic-conditions">
<h2>3.9. Loop through several economic conditions<a class="headerlink" href="#Loop-through-several-economic-conditions" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">EONR</span></code> computes the optimum nitrogen rate for any economic scenario that we define. The <code class="docutils literal notranslate"><span class="pre">EONR</span></code> class is designed so the economic condidtions can be adjusted, calculating the optimum nitrogen rate after each adjustment. We just have to set up a simple loop to update the economic scenario (using <code class="docutils literal notranslate"><span class="pre">EONR.update_econ()</span></code>) and calculate the EONR (using <code class="docutils literal notranslate"><span class="pre">EONR.calculate_eonr()</span></code>).</p>
<p>We will also generate plots and save them to our base directory right away:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">price_grain</span> <span class="o">=</span> <span class="mf">0.157</span>  <span class="c1"># set from $1 to 15.7 cents per kg</span>
<span class="n">cost_n_fert_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">1.32</span><span class="p">,</span> <span class="mf">2.20</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cost_n_fert</span> <span class="ow">in</span> <span class="n">cost_n_fert_list</span><span class="p">:</span>
    <span class="c1"># first, update fertilizer cost</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">update_econ</span><span class="p">(</span><span class="n">cost_n_fert</span><span class="o">=</span><span class="n">cost_n_fert</span><span class="p">,</span>
                        <span class="n">price_grain</span><span class="o">=</span><span class="n">price_grain</span><span class="p">)</span>
    <span class="c1"># second, calculate EONR</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">calculate_eonr</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
    <span class="c1"># third, generate (and save) the plots</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">plot_eonr</span><span class="p">(</span><span class="n">x_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mi">2600</span><span class="p">)</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">plot_save</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;eonr_mn2012_pre.png&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">my_eonr</span><span class="o">.</span><span class="n">fig_eonr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Computing EONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.44 per kg
Price grain: $0.16 per kg
Economic optimum N rate (EONR): 169.9 kg per ha [135.2, 220.9] (90.0% confidence)
Maximum return to N (MRTN): $2055.53 per ha

Computing EONR for Minnesota 2012 Pre
Cost of N fertilizer: $1.32 per kg
Price grain: $0.16 per kg
Economic optimum N rate (EONR): 154.8 kg per ha [125.7, 195.0] (90.0% confidence)
Maximum return to N (MRTN): $1912.67 per ha

Computing EONR for Minnesota 2012 Pre
Cost of N fertilizer: $2.20 per kg
Price grain: $0.16 per kg
Economic optimum N rate (EONR): 139.7 kg per ha [115.9, 170.1] (90.0% confidence)
Maximum return to N (MRTN): $1783.10 per ha
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_15_1.png" src="_images/advanced_tutorial_15_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_15_2.png" src="_images/advanced_tutorial_15_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_15_3.png" src="_images/advanced_tutorial_15_3.png" />
</div>
</div>
<p>A similar loop can be made adjusting the social cost of nitrogen. <code class="docutils literal notranslate"><span class="pre">my_eonr.base_zero</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to compare the graphs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">price_grain</span> <span class="o">=</span> <span class="mf">0.157</span>  <span class="c1"># keep at 15.7 cents per kg</span>
<span class="n">cost_n_fert</span> <span class="o">=</span> <span class="mf">0.88</span>  <span class="c1"># set to be constant</span>
<span class="n">my_eonr</span><span class="o">.</span><span class="n">update_econ</span><span class="p">(</span><span class="n">price_grain</span><span class="o">=</span><span class="n">price_grain</span><span class="p">,</span>
                    <span class="n">cost_n_fert</span><span class="o">=</span><span class="n">cost_n_fert</span><span class="p">)</span>
<span class="n">my_eonr</span><span class="o">.</span><span class="n">base_zero</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># let&#39;s use base zero to compare graphs</span>

<span class="n">cost_n_social_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">1.32</span><span class="p">,</span> <span class="mf">2.20</span><span class="p">,</span> <span class="mf">4.40</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cost_n_social</span> <span class="ow">in</span> <span class="n">cost_n_social_list</span><span class="p">:</span>
    <span class="c1"># first, update social cost</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">update_econ</span><span class="p">(</span><span class="n">cost_n_social</span><span class="o">=</span><span class="n">cost_n_social</span><span class="p">)</span>
    <span class="c1"># second, calculate EONR</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">calculate_eonr</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
    <span class="c1"># third, generate (and save) the plots</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">plot_eonr</span><span class="p">(</span><span class="n">x_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=-</span><span class="mi">400</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mi">1400</span><span class="p">)</span>
    <span class="n">my_eonr</span><span class="o">.</span><span class="n">plot_save</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;eonr_mn2012_pre.png&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">my_eonr</span><span class="o">.</span><span class="n">fig_eonr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Computing SONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.88 per kg
Price grain: $0.16 per kg
Social cost of N: $0.44 per kg
Socially optimum N rate (SONR): 158.7 kg per ha [128.1, 201.5] (90.0% confidence)
Maximum return to N (MRTN): $777.56 per ha

Computing SONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.88 per kg
Price grain: $0.16 per kg
Social cost of N: $1.32 per kg
Socially optimum N rate (SONR): 151.9 kg per ha [123.8, 190.1] (90.0% confidence)
Maximum return to N (MRTN): $799.07 per ha

Computing SONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.88 per kg
Price grain: $0.16 per kg
Social cost of N: $2.20 per kg
Socially optimum N rate (SONR): 145.8 kg per ha [119.9, 180.0] (90.0% confidence)
Maximum return to N (MRTN): $823.17 per ha

Computing SONR for Minnesota 2012 Pre
Cost of N fertilizer: $0.88 per kg
Price grain: $0.16 per kg
Social cost of N: $4.40 per kg
Socially optimum N rate (SONR): 132.7 kg per ha [111.2, 159.1] (90.0% confidence)
Maximum return to N (MRTN): $892.67 per ha
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_17_1.png" src="_images/advanced_tutorial_17_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_17_2.png" src="_images/advanced_tutorial_17_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_17_3.png" src="_images/advanced_tutorial_17_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/advanced_tutorial_17_4.png" src="_images/advanced_tutorial_17_4.png" />
</div>
</div>
<p>Notice that we used the same <code class="docutils literal notranslate"><span class="pre">EONR</span></code> instance (<code class="docutils literal notranslate"><span class="pre">my_eonr</span></code>) for all runs. This is convenient if there are many combinations of economic scenarios (or many experimental datasets) that you’d like to loop through. If you’d like the results to be saved separate (perhaps to separate results depending if a social cost is considered) that’s fine too. Simply create a new instance of <code class="docutils literal notranslate"><span class="pre">EONR</span></code> and customize how you’d like.</p>
</div>
<hr class="docutils" />
<div class="section" id="View-results">
<h2>3.10. View results<a class="headerlink" href="#View-results" title="Permalink to this headline">¶</a></h2>
<p>All eight runs can be viewed in the dataframe:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_eonr</span><span class="o">.</span><span class="n">df_results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price_grain</th>
      <th>cost_n_fert</th>
      <th>cost_n_social</th>
      <th>price_ratio</th>
      <th>unit_price_grain</th>
      <th>unit_cost_n</th>
      <th>location</th>
      <th>year</th>
      <th>time_n</th>
      <th>base_zero</th>
      <th>...</th>
      <th>mrtn</th>
      <th>grtn_r2_adj</th>
      <th>grtn_rmse</th>
      <th>grtn_max_y</th>
      <th>grtn_crit_x</th>
      <th>grtn_y_int</th>
      <th>scn_lin_r2</th>
      <th>scn_lin_rmse</th>
      <th>scn_exp_r2</th>
      <th>scn_exp_rmse</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>NaN</td>
      <td>...</td>
      <td>13579.232456</td>
      <td>0.728926</td>
      <td>1154.305686</td>
      <td>13579.232456</td>
      <td>177.437339</td>
      <td>7735.725352</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.157</td>
      <td>0.44</td>
      <td>0</td>
      <td>2.802548</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>NaN</td>
      <td>...</td>
      <td>2055.528038</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>2131.939496</td>
      <td>177.437340</td>
      <td>1214.508882</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.157</td>
      <td>1.32</td>
      <td>0</td>
      <td>8.407643</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>NaN</td>
      <td>...</td>
      <td>1912.670950</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>2131.939496</td>
      <td>177.437340</td>
      <td>1214.508882</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.157</td>
      <td>2.2</td>
      <td>0</td>
      <td>14.012739</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>NaN</td>
      <td>...</td>
      <td>1783.101634</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>2131.939496</td>
      <td>177.437340</td>
      <td>1214.508882</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.157</td>
      <td>0.88</td>
      <td>0.44</td>
      <td>8.407643</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>1214.508882</td>
      <td>...</td>
      <td>777.563499</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>917.431894</td>
      <td>177.440056</td>
      <td>0.016205</td>
      <td>0.777106</td>
      <td>55.7255</td>
      <td>0.836099</td>
      <td>8.44737</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.157</td>
      <td>0.88</td>
      <td>1.32</td>
      <td>14.012739</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>1214.508882</td>
      <td>...</td>
      <td>799.067077</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>917.431894</td>
      <td>177.440056</td>
      <td>0.016205</td>
      <td>0.777106</td>
      <td>167.176</td>
      <td>0.836099</td>
      <td>25.3421</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.157</td>
      <td>0.88</td>
      <td>2.2</td>
      <td>19.617834</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>1214.508882</td>
      <td>...</td>
      <td>823.173264</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>917.431894</td>
      <td>177.440056</td>
      <td>0.016205</td>
      <td>0.777106</td>
      <td>278.627</td>
      <td>0.836099</td>
      <td>42.2368</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.157</td>
      <td>0.88</td>
      <td>4.4</td>
      <td>33.630573</td>
      <td>$ per ha</td>
      <td>$ per kg</td>
      <td>Minnesota</td>
      <td>2012</td>
      <td>Pre</td>
      <td>1214.508882</td>
      <td>...</td>
      <td>892.669088</td>
      <td>0.728926</td>
      <td>181.225993</td>
      <td>917.431894</td>
      <td>177.440056</td>
      <td>0.016205</td>
      <td>0.777106</td>
      <td>557.255</td>
      <td>0.836099</td>
      <td>84.4737</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 29 columns</p>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EONR.df_results</span></code> contains the following data columns (some columns are hidden by Jupyter in the table above):</p>
<ul class="simple">
<li><p><strong>price_grain</strong> – price of grain</p></li>
<li><p><strong>cost_n_fert</strong> – cost of nitrogen fertilizer</p></li>
<li><p><strong>cost_n_social</strong> – other “social” costs of nitrogen</p></li>
<li><p><strong>price_ratio</strong> – <em>cost:grain</em> price ratio</p></li>
<li><p><strong>unit_price_grain</strong> – units descirbing the price of grain</p></li>
<li><p><strong>unit_cost_n</strong> – units describing cost of nitrogen (both fertilizer and social costs)</p></li>
<li><p><strong>location</strong> – location of dataset</p></li>
<li><p><strong>year</strong> – year of dataset</p></li>
<li><p><strong>time_n</strong> – nitrogen application timing of dataset</p></li>
<li><p><strong>base_zero</strong> – if <code class="docutils literal notranslate"><span class="pre">base_zero</span> <span class="pre">=</span> <span class="pre">True</span></code>, this is the y-intercept (<span class="math notranslate nohighlight">\(\beta_0\)</span>) of the quadratic-plateau model before standardizing the data</p></li>
<li><p><strong>eonr</strong> – optimum nitrogen rate (can be <em>agronomic</em>, <em>economic</em>, or <em>socially</em> optimum; in units of `EONR.unit_nrate)</p></li>
<li><p><strong>eonr_error</strong> – error in reparameterized quadratic-plateau model for computation of confidence intervals</p></li>
<li><p><strong>ci_level</strong> – confidence interval (CI) level (for subsequent confidence bounds)</p></li>
<li><p><strong>ci_wald_l</strong> – lower Wald CI</p></li>
<li><p><strong>ci_wald_u</strong> – upper Wald CI</p></li>
<li><p><strong>ci_pl_l</strong> – lower profile-likelihood CI</p></li>
<li><p><strong>ci_pl_</strong> – upper profile-likelihood CI</p></li>
<li><p><strong>ci_boot_l</strong> – lower bootstrap CI</p></li>
<li><p><strong>ci_boot_u</strong> – upper bootstrap CI</p></li>
<li><p><strong>mrtn</strong> – maximum return to nitrogen (in units of <code class="docutils literal notranslate"><span class="pre">EONR.unit_currency</span></code>)</p></li>
<li><p><strong>grtn_r2_adj</strong> – adjusted <span class="math notranslate nohighlight">\(\text{r}^2\)</span> value of the gross return to nitrogen (GRTN) model</p></li>
<li><p><strong>grtn_rmse</strong> – root mean squared error of the GRTN</p></li>
<li><p><strong>grtn_max_y</strong> – maximum y value of the GRTN (in units of <code class="docutils literal notranslate"><span class="pre">EONR.unit_rtn</span></code>)</p></li>
<li><p><strong>grtn_crit_x</strong> – critical x-value of the GRTN (point where the “quadratic” part of the quadratic-plateau model terminates and the “plateau” commences)</p></li>
<li><p><strong>grtn_y_int</strong> – y-intercept (<span class="math notranslate nohighlight">\(\beta_0\)</span>) of the GRTN model</p></li>
<li><p><strong>scn_lin_r2</strong> – adjusted <span class="math notranslate nohighlight">\(\text{r}^2\)</span> value of the linear best-fit for social cost of nitrogen</p></li>
<li><p><strong>scn_lin_rmse</strong> – root mean squared error of the the linear best-fit for social cost of nitrogen</p></li>
<li><p><strong>scn_exp_r2</strong> – adjusted <span class="math notranslate nohighlight">\(\text{r}^2\)</span> value value of the exponential best-fit for social cost of nitrogen</p></li>
<li><p><strong>scn_exp_rmse</strong> – root mean squared error of the the exponential best-fit for social cost of nitrogen</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="Save-the-data">
<h2>3.11. Save the data<a class="headerlink" href="#Save-the-data" title="Permalink to this headline">¶</a></h2>
<p>The results generated by <code class="docutils literal notranslate"><span class="pre">EONR</span></code> can be saved to the <code class="docutils literal notranslate"><span class="pre">EONR.base_dir</span></code> using the <code class="docutils literal notranslate"><span class="pre">Pandas</span></code> <code class="docutils literal notranslate"><span class="pre">df.to_csv()</span></code> function. A folder will be created in the base_dir whose name is determined by the <strong>current economic scenario</strong> of <code class="docutils literal notranslate"><span class="pre">my_eonr</span></code> (in this case “social_336_4400”, corresponding to <code class="docutils literal notranslate"><span class="pre">cost_n_social</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">price_ratio</span> <span class="pre">==</span> <span class="pre">33.6</span></code>, and <code class="docutils literal notranslate"><span class="pre">cost_n_social</span> <span class="pre">==</span> <span class="pre">4.40</span></code> for “social”, “336”, and “4400” in the folder name, respectively):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_eonr</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>

<span class="n">my_eonr</span><span class="o">.</span><span class="n">df_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">my_eonr</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;advanced_tutorial_results.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">my_eonr</span><span class="o">.</span><span class="n">df_ci</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">my_eonr</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;advanced_tutorial_ci.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
F:\nigo0024\Documents\GitHub\eonr\eonr\examples\eonr_advanced_tutorial\social_336_4400
</pre></div></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3. Advanced Tutorial</a><ul>
<li><a class="reference internal" href="#Follow-along">3.1. Follow along</a></li>
<li><a class="reference internal" href="#Calculate-EONR-for-several-economic-scenarios">3.2. Calculate <code class="docutils literal notranslate"><span class="pre">EONR</span></code> for several economic scenarios</a></li>
<li><a class="reference internal" href="#Load-modules">3.3. Load modules</a></li>
<li><a class="reference internal" href="#Load-the-data">3.4. Load the data</a></li>
<li><a class="reference internal" href="#Set-column-names-and-units">3.5. Set column names and units</a></li>
<li><a class="reference internal" href="#Turn-base_zero-off">3.6. Turn <code class="docutils literal notranslate"><span class="pre">base_zero</span></code> off</a></li>
<li><a class="reference internal" href="#Initialize-EONR">3.7. Initialize <code class="docutils literal notranslate"><span class="pre">EONR</span></code></a></li>
<li><a class="reference internal" href="#Calculate-the-AONR">3.8. Calculate the <em>AONR</em></a></li>
<li><a class="reference internal" href="#Loop-through-several-economic-conditions">3.9. Loop through several economic conditions</a></li>
<li><a class="reference internal" href="#View-results">3.10. View results</a></li>
<li><a class="reference internal" href="#Save-the-data">3.11. Save the data</a></li>
</ul>
</li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="background.html" title="4. Background"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="tutorial.html" title="2. Tutorial"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">eonr 0.0.1 documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Tyler J Nigon.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>